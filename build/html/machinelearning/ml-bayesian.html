

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="zh-CN" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="zh-CN" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>样例 - 贝叶斯 &mdash; Data Science 1.0 文档</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script type="text/javascript" src="../_static/translations.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="next" title="样例 - TFIDF" href="ml-tfidf.html" />
    <link rel="prev" title="样例 - 回归" href="ml-lm.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Data Science
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">目录:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../README1.html">Data Science数据科学路线图</a></li>
<li class="toctree-l1"><a class="reference internal" href="../python/index.html">Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../R/index.html">R</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">机器学习</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="machinelearning.html">机器学习概览</a></li>
<li class="toctree-l2"><a class="reference internal" href="ml-lm.html">样例 - 回归</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">样例 - 贝叶斯</a></li>
<li class="toctree-l2"><a class="reference internal" href="ml-tfidf.html">样例 - TFIDF</a></li>
<li class="toctree-l2"><a class="reference internal" href="ml-knn.html">样例 - k-NN k近邻</a></li>
<li class="toctree-l2"><a class="reference internal" href="ml-classification_tree.html">样例 - 分类树、回归树</a></li>
<li class="toctree-l2"><a class="reference internal" href="ml-glm.html">样例 - 逻辑回归</a></li>
<li class="toctree-l2"><a class="reference internal" href="evaluationpredictiveperformance.html">机器学习评估预测性能</a></li>
<li class="toctree-l2"><a class="reference internal" href="oracleml4python.html">Oracle机器学习 for Python</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../businessanalysis/index.html">Business Analysis 业务分析</a></li>
<li class="toctree-l1"><a class="reference internal" href="../managementmodel/index.html">管理模型</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Data Science</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">机器学习</a> &raquo;</li>
        
      <li>样例 - 贝叶斯</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/machinelearning/ml-bayesian.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="id1">
<h1>样例 - 贝叶斯<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h1>
<ul>
<li><p>朴素贝叶斯分类</p>
<p>完全（精确）贝叶斯计算与朴素贝叶斯计算样例。</p>
<ol class="arabic simple">
<li><p>用10条记录计算有法律麻烦的大小公司欺诈的可能性 - 贝叶斯 &amp; 朴素贝叶斯（样例1）</p></li>
<li><p>利用FlightDelays.csv数据集来预测航班误点可能性 - 朴素贝叶斯（样例2）</p></li>
</ol>
</li>
</ul>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># 利用数据集2进行Complete（Exact）精确贝叶斯计算</span>

<span class="c1">##</span>
<span class="n">df</span> <span class="o">&lt;-</span> <span class="nf">read.csv</span><span class="p">((</span><span class="s">&quot;D:\\Books\\dataset\\company10.csv&quot;</span><span class="p">))</span>
<span class="o">&gt;</span> <span class="n">df</span>
   <span class="n">company</span> <span class="n">plt</span> <span class="n">CompanySize</span>     <span class="n">Status</span>
<span class="m">1</span>        <span class="m">1</span> <span class="n">Yes</span>       <span class="n">Small</span>   <span class="n">Truthful</span>
<span class="m">2</span>        <span class="m">2</span>  <span class="n">No</span>       <span class="n">Small</span>   <span class="n">Truthful</span>
<span class="m">3</span>        <span class="m">3</span>  <span class="n">No</span>       <span class="n">Large</span>   <span class="n">Truthful</span>
<span class="m">4</span>        <span class="m">4</span>  <span class="n">No</span>       <span class="n">Large</span>   <span class="n">Truthful</span>
<span class="m">5</span>        <span class="m">5</span>  <span class="n">No</span>       <span class="n">Small</span>   <span class="n">Truthful</span>
<span class="m">6</span>        <span class="m">6</span>  <span class="n">No</span>       <span class="n">Small</span>   <span class="n">Truthful</span>
<span class="m">7</span>        <span class="m">7</span> <span class="n">Yes</span>       <span class="n">Small</span> <span class="n">Fraudulent</span>
<span class="m">8</span>        <span class="m">8</span> <span class="n">Yes</span>       <span class="n">Large</span> <span class="n">Fraudulent</span>
<span class="m">9</span>        <span class="m">9</span>  <span class="n">No</span>       <span class="n">Large</span> <span class="n">Fraudulent</span>
<span class="m">10</span>      <span class="m">10</span> <span class="n">Yes</span>       <span class="n">Large</span> <span class="n">Fraudulent</span>


<span class="c1"># 计算有法律麻烦的小公司，欺诈的概率 P(fraudulent|PriorLegal = y,Size = small) = 1/2=0.5</span>
<span class="n">dfsmall</span> <span class="o">&lt;-</span> <span class="nf">subset</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">df</span><span class="o">$</span><span class="n">plt</span> <span class="o">==</span> <span class="s">&#39;Yes&#39;</span> <span class="o">&amp;</span> <span class="n">df</span><span class="o">$</span><span class="n">CompanySize</span> <span class="o">==</span> <span class="s">&#39;Small&#39;</span><span class="p">)</span>
<span class="n">dfsmall</span>
  <span class="n">company</span> <span class="n">plt</span> <span class="n">CompanySize</span>     <span class="n">Status</span>
<span class="m">1</span>       <span class="m">1</span> <span class="n">Yes</span>       <span class="n">Small</span>   <span class="n">Truthful</span>
<span class="m">7</span>       <span class="m">7</span> <span class="n">Yes</span>       <span class="n">Small</span> <span class="n">Fraudulent</span>

<span class="c1"># 计算有法律麻烦的大公司，欺诈的概率P(fraudulent|PriorLegal = y,Size = large) = 2/2 = 1</span>
<span class="n">dflarge</span> <span class="o">&lt;-</span> <span class="nf">subset</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">df</span><span class="o">$</span><span class="n">plt</span> <span class="o">==</span> <span class="s">&#39;Yes&#39;</span> <span class="o">&amp;</span> <span class="n">df</span><span class="o">$</span><span class="n">CompanySize</span> <span class="o">==</span> <span class="s">&#39;Large&#39;</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="n">dflarge</span>
  <span class="n">company</span> <span class="n">plt</span> <span class="n">CompanySize</span>     <span class="n">Status</span>
<span class="m">8</span>        <span class="m">8</span> <span class="n">Yes</span>       <span class="n">Large</span> <span class="n">Fraudulent</span>
<span class="m">10</span>      <span class="m">10</span> <span class="n">Yes</span>       <span class="n">Large</span> <span class="n">Fraudulent</span>

<span class="c1"># 计算没有法律麻烦的小公司，欺诈的概率P(fraudulent|PriorLegal = n,Size = small) = 0/3 = 0</span>
<span class="o">&gt;</span> <span class="n">dfNsmall</span> <span class="o">&lt;-</span> <span class="nf">subset</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">df</span><span class="o">$</span><span class="n">plt</span> <span class="o">==</span> <span class="s">&#39;No&#39;</span> <span class="o">&amp;</span> <span class="n">df</span><span class="o">$</span><span class="n">CompanySize</span> <span class="o">==</span> <span class="s">&#39;Small&#39;</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="n">dfNsmall</span>
  <span class="n">company</span> <span class="n">plt</span> <span class="n">CompanySize</span>   <span class="n">Status</span>
<span class="m">2</span>       <span class="m">2</span>  <span class="n">No</span>       <span class="n">Small</span> <span class="n">Truthful</span>
<span class="m">5</span>       <span class="m">5</span>  <span class="n">No</span>       <span class="n">Small</span> <span class="n">Truthful</span>
<span class="m">6</span>       <span class="m">6</span>  <span class="n">No</span>       <span class="n">Small</span> <span class="n">Truthful</span>

<span class="c1"># 计算没有法律麻烦的大公司，欺诈的概率 P(fraudulent|PriorLegal = n,Size = large) = 1/3 = 0.33</span>
<span class="o">&gt;</span> <span class="n">dfNlarge</span> <span class="o">&lt;-</span> <span class="nf">subset</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">df</span><span class="o">$</span><span class="n">plt</span> <span class="o">==</span> <span class="s">&#39;No&#39;</span> <span class="o">&amp;</span> <span class="n">df</span><span class="o">$</span><span class="n">CompanySize</span> <span class="o">==</span> <span class="s">&#39;Large&#39;</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="n">dfNlarge</span>
  <span class="n">company</span> <span class="n">plt</span> <span class="n">CompanySize</span>     <span class="n">Status</span>
<span class="m">3</span>       <span class="m">3</span>  <span class="n">No</span>       <span class="n">Large</span>   <span class="n">Truthful</span>
<span class="m">4</span>       <span class="m">4</span>  <span class="n">No</span>       <span class="n">Large</span>   <span class="n">Truthful</span>
<span class="m">9</span>       <span class="m">9</span>  <span class="n">No</span>       <span class="n">Large</span> <span class="n">Fraudulent</span>

<span class="c1"># 利用数据集进行 朴素贝叶斯 计算</span>

<span class="c1"># 引用e1071 朴素贝叶斯程序包</span>
<span class="nf">library</span><span class="p">(</span><span class="n">e1071</span><span class="p">)</span>
<span class="n">df.nb2</span> <span class="o">&lt;-</span> <span class="nf">naiveBayes</span><span class="p">(</span><span class="n">Status</span> <span class="o">~</span> <span class="n">.,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">df[</span><span class="p">,</span> <span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">4</span><span class="p">)</span><span class="n">]</span><span class="p">)</span>
<span class="n">df.nb2</span>
<span class="n">Naive</span> <span class="n">Bayes</span> <span class="n">Classifier</span> <span class="n">for</span> <span class="n">Discrete</span> <span class="n">Predictors</span>

<span class="n">Call</span><span class="o">:</span>
<span class="nf">naiveBayes.default</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">Y</span><span class="p">,</span> <span class="n">laplace</span> <span class="o">=</span> <span class="n">laplace</span><span class="p">)</span>

<span class="n">A</span><span class="o">-</span><span class="n">priori</span> <span class="n">probabilities</span><span class="o">:</span>
<span class="n">Y</span>
<span class="n">Fraudulent</span>   <span class="n">Truthful</span>
       <span class="m">0.4</span>        <span class="m">0.6</span>

<span class="n">Conditional</span> <span class="n">probabilities</span><span class="o">:</span>
            <span class="n">plt</span>
<span class="n">Y</span>                   <span class="n">No</span>       <span class="n">Yes</span>
  <span class="n">Fraudulent</span> <span class="m">0.2500000</span> <span class="m">0.7500000</span>
  <span class="n">Truthful</span>   <span class="m">0.8333333</span> <span class="m">0.1666667</span>

            <span class="n">CompanySize</span>
<span class="n">Y</span>                <span class="n">Large</span>     <span class="n">Small</span>
  <span class="n">Fraudulent</span> <span class="m">0.7500000</span> <span class="m">0.2500000</span>
  <span class="n">Truthful</span>   <span class="m">0.3333333</span> <span class="m">0.6666667</span>
<span class="o">&gt;</span> <span class="nf">prop.table</span><span class="p">(</span><span class="nf">table</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">Status</span><span class="p">,</span> <span class="n">df</span><span class="o">$</span><span class="n">CompanySize</span><span class="p">,</span> <span class="n">df</span><span class="o">$</span><span class="n">plt</span><span class="p">),</span> <span class="n">margin</span><span class="o">=</span><span class="m">1</span><span class="p">)</span>
<span class="p">,</span> <span class="p">,</span>  <span class="o">=</span> <span class="n">No</span>


                 <span class="n">Large</span>     <span class="n">Small</span>
  <span class="n">Fraudulent</span> <span class="m">0.2500000</span> <span class="m">0.0000000</span>
  <span class="n">Truthful</span>   <span class="m">0.3333333</span> <span class="m">0.5000000</span>

<span class="p">,</span> <span class="p">,</span>  <span class="o">=</span> <span class="n">Yes</span>


                 <span class="n">Large</span>     <span class="n">Small</span>
  <span class="n">Fraudulent</span> <span class="m">0.5000000</span> <span class="m">0.2500000</span>
  <span class="n">Truthful</span>   <span class="m">0.0000000</span> <span class="m">0.1666667</span>

<span class="c1"># P(fraudulent|PriorLegal = y, Size = small) =</span>
<span class="c1"># P(PriorLegal = yes, Size = small|fraudulent) * P(fraudulent) /</span>
<span class="c1"># P(PriorLegal = yes, Size = small|fraudulent) * P(fraudulent) + P(PriorLegal = yes, Size = small|Truthful) * P(Truthful)</span>
<span class="c1"># 把所有欺诈的记录找出来，求取在欺诈记录中，有法律麻烦plt=yes的概率：3/4 小公司的概率：1/4</span>
<span class="o">&gt;</span> <span class="nf">subset</span><span class="p">(</span><span class="n">df_nb</span><span class="p">,</span> <span class="n">df_nb</span><span class="o">$</span><span class="n">Status</span> <span class="o">==</span> <span class="s">&#39;Fraudulent&#39;</span><span class="p">)</span>
  <span class="n">plt</span> <span class="n">CompanySize</span>     <span class="n">Status</span>
<span class="m">7</span>  <span class="n">Yes</span>       <span class="n">Small</span> <span class="n">Fraudulent</span>
<span class="m">8</span>  <span class="n">Yes</span>       <span class="n">Large</span> <span class="n">Fraudulent</span>
<span class="m">9</span>   <span class="n">No</span>       <span class="n">Large</span> <span class="n">Fraudulent</span>
<span class="m">10</span> <span class="n">Yes</span>       <span class="n">Large</span> <span class="n">Fraudulent</span>
<span class="c1"># P(PriorLegal = yes|fraudulent) = 3/4</span>
<span class="c1">#</span>
<span class="c1"># P(Size = small|fraudulent) = 1/4</span>

<span class="c1"># P(fraudulent)</span>
<span class="o">&gt;</span> <span class="nf">dim</span><span class="p">(</span><span class="nf">subset</span><span class="p">(</span><span class="n">df_nb</span><span class="p">,</span> <span class="n">df_nb</span><span class="o">$</span><span class="n">Status</span> <span class="o">==</span> <span class="s">&#39;Fraudulent&#39;</span><span class="p">))</span><span class="n">[1]</span><span class="o">/</span><span class="nf">dim</span><span class="p">(</span><span class="n">df_nb</span><span class="p">)</span><span class="n">[1]</span>
<span class="n">[1]</span> <span class="m">0.4</span>
<span class="c1"># 分子为：P(PriorLegal = yes, Size = small|fraudulent) * P(fraudulent) =</span>
<span class="c1"># P(PriorLegal = yes|fraudulent) * P(Size = small|fraudulent) * P(fraudulent)</span>
<span class="o">&gt;</span> <span class="m">3</span><span class="o">/</span><span class="m">4</span> <span class="o">*</span> <span class="m">1</span><span class="o">/</span><span class="m">4</span> <span class="o">*</span> <span class="m">0.4</span>
<span class="n">[1]</span>  <span class="m">0.075</span>
<span class="c1"># 把所有诚实的记录找出来，求取在诚实的记录中，有法律麻烦plt=yes的概率，小公司的概率：</span>
<span class="o">&gt;</span> <span class="nf">subset</span><span class="p">(</span><span class="n">df_nb</span><span class="p">,</span> <span class="n">df_nb</span><span class="o">$</span><span class="n">Status</span> <span class="o">==</span> <span class="s">&#39;Truthful&#39;</span><span class="p">)</span>
 <span class="n">plt</span> <span class="n">CompanySize</span>   <span class="n">Status</span>
<span class="m">1</span> <span class="n">Yes</span>       <span class="n">Small</span> <span class="n">Truthful</span>
<span class="m">2</span>  <span class="n">No</span>       <span class="n">Small</span> <span class="n">Truthful</span>
<span class="m">3</span>  <span class="n">No</span>       <span class="n">Large</span> <span class="n">Truthful</span>
<span class="m">4</span>  <span class="n">No</span>       <span class="n">Large</span> <span class="n">Truthful</span>
<span class="m">5</span>  <span class="n">No</span>       <span class="n">Small</span> <span class="n">Truthful</span>
<span class="m">6</span>  <span class="n">No</span>       <span class="n">Small</span> <span class="n">Truthful</span>

<span class="c1"># 求取分母另一项：P(PriorLegal = yes|Truthful) * P(Size = small|Truthful) * P(Truthful)</span>
<span class="c1"># P(PriorLegal = yes|Truthful) 为 1/6</span>
<span class="c1"># P(Size = small|Truthful) 为 4/6</span>
<span class="c1"># P(Truthful) = 6/10</span>
<span class="c1"># P(PriorLegal = yes|Truthful) * P(Size = small|Truthful) * P(Truthful) =</span>
<span class="o">&gt;</span> <span class="m">1</span><span class="o">/</span><span class="m">6</span> <span class="o">*</span> <span class="m">4</span><span class="o">/</span><span class="m">6</span> <span class="o">*</span> <span class="m">6</span><span class="o">/</span><span class="m">10</span>
<span class="n">[1]</span> <span class="m">0.067</span>
<span class="c1"># 有法律麻烦的小企业，欺诈的概率 = 0.053</span>
<span class="c1"># P(fraudulent|PriorLegal = y, Size = small) = 0.075 / ( 0.075 + 0.067) 约为0.53</span>
<span class="n">[1]</span> <span class="m">0.0528</span>
<span class="c1"># 同理，可以用同样的方法计算有法律麻烦的大企业，欺诈的概率</span>
<span class="c1"># P(fraudulent|PriorLegal = y, Size = large) = 0.87</span>
<span class="c1"># P(PriorLegal = y|fraudulent) * P( Size = large|fraudulent) * P(fraudulent)/</span>
<span class="c1"># [P(PriorLegal = y|fraudulent) * P( Size = large|fraudulent) * P(fraudulent) + P(PriorLegal = y|Truthful) * P( Size = large|Truthful) * P(Truthful)]</span>
<span class="o">&gt;</span> <span class="m">3</span><span class="o">/</span><span class="m">4</span> <span class="o">*</span> <span class="m">3</span><span class="o">/</span><span class="m">4</span> <span class="o">*</span> <span class="m">4</span><span class="o">/</span><span class="m">10</span> <span class="o">/</span> <span class="p">(</span><span class="m">3</span><span class="o">/</span><span class="m">4</span> <span class="o">*</span> <span class="m">3</span><span class="o">/</span><span class="m">4</span> <span class="o">*</span> <span class="m">4</span><span class="o">/</span><span class="m">10</span> <span class="o">+</span> <span class="m">1</span><span class="o">/</span><span class="m">6</span> <span class="o">*</span> <span class="m">2</span><span class="o">/</span><span class="m">4</span> <span class="o">*</span> <span class="m">6</span><span class="o">/</span><span class="m">10</span><span class="p">)</span>
<span class="n">[1]</span> <span class="m">0.8181</span>
<span class="c1"># P(fraudulent|PriorLegal = n, Size = small) = 0.07</span>
<span class="c1"># P(fraudulent|PriorLegal = n, Size = large) = 0.31</span>
<span class="c1"># 如果从概率排序看，有法律麻烦的大企业的欺诈的概率高于有法律麻烦的小企业</span>
<span class="c1"># 注意这些朴素贝叶斯概率和精确贝叶斯概率有多接近</span>
<span class="c1"># 尽管他们不相等，但是他们会导致 相同的 分类，概率的排序甚至比概率本身更接近于准确的贝叶斯方法</span>
</pre></div>
</div>
<hr class="docutils" />
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># 以航班数据，预测航班误点可能性（朴素贝叶斯）</span>
<span class="o">&gt;</span> <span class="nf">library</span><span class="p">(</span><span class="n">e1071</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="n">delays.df</span> <span class="o">&lt;-</span> <span class="nf">read.csv</span><span class="p">(</span><span class="s">&quot;D:\\Books\\dataset\\FlightDelays.csv&quot;</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="n">delays.df[</span><span class="s">&#39;dayweek&#39;</span><span class="n">]</span> <span class="o">&lt;-</span> <span class="nf">factor</span><span class="p">(</span><span class="n">delays.df</span><span class="o">$</span><span class="n">dayweek</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="nf">head</span><span class="p">(</span><span class="n">delays.df</span><span class="p">)</span>
   <span class="n">schedtime</span> <span class="n">carrier</span> <span class="n">deptime</span> <span class="n">dest</span> <span class="n">distance</span>     <span class="n">date</span> <span class="n">flightnumber</span> <span class="n">origin</span> <span class="n">weather</span> <span class="n">dayweek</span> <span class="n">daymonth</span> <span class="n">tailnu</span>  <span class="n">delay</span> <span class="n">com_deptime</span>
<span class="m">1</span>      <span class="m">1455</span>      <span class="n">OH</span>      <span class="m">15</span>  <span class="n">JFK</span>      <span class="m">184</span> <span class="m">1</span><span class="o">/</span><span class="m">1</span><span class="o">/</span><span class="m">2004</span>         <span class="m">5935</span>    <span class="n">BWI</span>       <span class="m">0</span>       <span class="m">4</span>        <span class="m">1</span> <span class="n">N940CA</span> <span class="n">ontime</span>          <span class="m">15</span>
<span class="m">2</span>      <span class="m">1640</span>      <span class="n">DH</span>      <span class="m">16</span>  <span class="n">JFK</span>      <span class="m">213</span> <span class="m">1</span><span class="o">/</span><span class="m">1</span><span class="o">/</span><span class="m">2004</span>         <span class="m">6155</span>    <span class="n">DCA</span>       <span class="m">0</span>       <span class="m">4</span>        <span class="m">1</span> <span class="n">N405FJ</span> <span class="n">ontime</span>          <span class="m">16</span>
<span class="m">3</span>      <span class="m">1245</span>      <span class="n">DH</span>      <span class="m">12</span>  <span class="n">LGA</span>      <span class="m">229</span> <span class="m">1</span><span class="o">/</span><span class="m">1</span><span class="o">/</span><span class="m">2004</span>         <span class="m">7208</span>    <span class="n">IAD</span>       <span class="m">0</span>       <span class="m">4</span>        <span class="m">1</span> <span class="n">N695BR</span> <span class="n">ontime</span>          <span class="m">12</span>
<span class="m">4</span>      <span class="m">1715</span>      <span class="n">DH</span>      <span class="m">17</span>  <span class="n">LGA</span>      <span class="m">229</span> <span class="m">1</span><span class="o">/</span><span class="m">1</span><span class="o">/</span><span class="m">2004</span>         <span class="m">7215</span>    <span class="n">IAD</span>       <span class="m">0</span>       <span class="m">4</span>        <span class="m">1</span> <span class="n">N662BR</span> <span class="n">ontime</span>          <span class="m">17</span>
<span class="m">5</span>      <span class="m">1039</span>      <span class="n">DH</span>      <span class="m">10</span>  <span class="n">LGA</span>      <span class="m">229</span> <span class="m">1</span><span class="o">/</span><span class="m">1</span><span class="o">/</span><span class="m">2004</span>         <span class="m">7792</span>    <span class="n">IAD</span>       <span class="m">0</span>       <span class="m">4</span>        <span class="m">1</span> <span class="n">N698BR</span> <span class="n">ontime</span>          <span class="m">10</span>
<span class="m">6</span>       <span class="m">840</span>      <span class="n">DH</span>       <span class="m">8</span>  <span class="n">JFK</span>      <span class="m">228</span> <span class="m">1</span><span class="o">/</span><span class="m">1</span><span class="o">/</span><span class="m">2004</span>         <span class="m">7800</span>    <span class="n">IAD</span>       <span class="m">0</span>       <span class="m">4</span>        <span class="m">1</span> <span class="n">N687BR</span> <span class="n">ontime</span>           <span class="m">8</span>
<span class="o">&gt;</span> <span class="n">selected.var</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">8</span><span class="p">,</span><span class="m">10</span><span class="p">,</span><span class="m">13</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="n">train.df</span> <span class="o">&lt;-</span> <span class="n">delays.df[train.index</span><span class="p">,</span> <span class="n">selected.var]</span>
<span class="o">&gt;</span> <span class="n">valid.df</span> <span class="o">&lt;-</span> <span class="n">delays.df[</span><span class="o">-</span><span class="n">train.index</span><span class="p">,</span> <span class="n">selected.var]</span>
<span class="o">&gt;</span> <span class="n">delays.nb</span> <span class="o">&lt;-</span> <span class="nf">naiveBayes</span><span class="p">(</span><span class="n">delay</span> <span class="o">~</span> <span class="n">.,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">train.df</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="n">delays.nb</span>

<span class="n">Naive</span> <span class="n">Bayes</span> <span class="n">Classifier</span> <span class="n">for</span> <span class="n">Discrete</span> <span class="n">Predictors</span>

<span class="n">Call</span><span class="o">:</span>
<span class="nf">naiveBayes.default</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">Y</span><span class="p">,</span> <span class="n">laplace</span> <span class="o">=</span> <span class="n">laplace</span><span class="p">)</span>

<span class="n">A</span><span class="o">-</span><span class="n">priori</span> <span class="n">probabilities</span><span class="o">:</span>
<span class="n">Y</span>
  <span class="n">delayed</span>    <span class="n">ontime</span>
<span class="m">0.2015152</span> <span class="m">0.7984848</span>

<span class="n">Conditional</span> <span class="n">probabilities</span><span class="o">:</span>
         <span class="n">carrier</span>
<span class="n">Y</span>                  <span class="n">CO</span>          <span class="n">DH</span>          <span class="n">DL</span>          <span class="n">MQ</span>          <span class="n">OH</span>          <span class="n">RU</span>          <span class="n">UA</span>          <span class="n">US</span>
  <span class="n">delayed</span> <span class="m">0.056390977</span> <span class="m">0.285714286</span> <span class="m">0.090225564</span> <span class="m">0.206766917</span> <span class="m">0.011278195</span> <span class="m">0.248120301</span> <span class="m">0.007518797</span> <span class="m">0.093984962</span>
  <span class="n">ontime</span>  <span class="m">0.035104364</span> <span class="m">0.235294118</span> <span class="m">0.187855787</span> <span class="m">0.115749526</span> <span class="m">0.017077799</span> <span class="m">0.179316888</span> <span class="m">0.018026565</span> <span class="m">0.211574953</span>

         <span class="n">deptime</span>
<span class="n">Y</span>                   <span class="m">0</span>           <span class="m">1</span>           <span class="m">5</span>           <span class="m">6</span>           <span class="m">7</span>           <span class="m">8</span>           <span class="m">9</span>          <span class="m">10</span>          <span class="m">11</span>          <span class="m">12</span>          <span class="m">13</span>
  <span class="n">delayed</span> <span class="m">0.003759398</span> <span class="m">0.000000000</span> <span class="m">0.000000000</span> <span class="m">0.026315789</span> <span class="m">0.067669173</span> <span class="m">0.037593985</span> <span class="m">0.033834586</span> <span class="m">0.022556391</span> <span class="m">0.033834586</span> <span class="m">0.018796992</span> <span class="m">0.045112782</span>
  <span class="n">ontime</span>  <span class="m">0.000000000</span> <span class="m">0.000000000</span> <span class="m">0.000000000</span> <span class="m">0.065464896</span> <span class="m">0.062618596</span> <span class="m">0.066413662</span> <span class="m">0.059772296</span> <span class="m">0.055028463</span> <span class="m">0.034155598</span> <span class="m">0.069259962</span> <span class="m">0.068311195</span>
         <span class="n">deptime</span>
<span class="n">Y</span>                  <span class="m">14</span>          <span class="m">15</span>          <span class="m">16</span>          <span class="m">17</span>          <span class="m">18</span>          <span class="m">19</span>          <span class="m">20</span>          <span class="m">21</span>          <span class="m">22</span>          <span class="m">23</span>
  <span class="n">delayed</span> <span class="m">0.033834586</span> <span class="m">0.176691729</span> <span class="m">0.101503759</span> <span class="m">0.071428571</span> <span class="m">0.078947368</span> <span class="m">0.086466165</span> <span class="m">0.063909774</span> <span class="m">0.041353383</span> <span class="m">0.052631579</span> <span class="m">0.003759398</span>
  <span class="n">ontime</span>  <span class="m">0.061669829</span> <span class="m">0.100569260</span> <span class="m">0.089184061</span> <span class="m">0.092979127</span> <span class="m">0.045540797</span> <span class="m">0.038899431</span> <span class="m">0.025616698</span> <span class="m">0.064516129</span> <span class="m">0.000000000</span> <span class="m">0.000000000</span>

         <span class="n">dest</span>
<span class="n">Y</span>               <span class="n">EWR</span>       <span class="n">JFK</span>       <span class="n">LGA</span>
  <span class="n">delayed</span> <span class="m">0.4060150</span> <span class="m">0.1992481</span> <span class="m">0.3947368</span>
  <span class="n">ontime</span>  <span class="m">0.2865275</span> <span class="m">0.1707780</span> <span class="m">0.5426945</span>

         <span class="n">origin</span>
<span class="n">Y</span>                <span class="n">BWI</span>        <span class="n">DCA</span>        <span class="n">IAD</span>
  <span class="n">delayed</span> <span class="m">0.09774436</span> <span class="m">0.52255639</span> <span class="m">0.37969925</span>
  <span class="n">ontime</span>  <span class="m">0.06261860</span> <span class="m">0.63662239</span> <span class="m">0.30075901</span>

         <span class="n">dayweek</span>
<span class="n">Y</span>                  <span class="m">1</span>          <span class="m">2</span>          <span class="m">3</span>          <span class="m">4</span>          <span class="m">5</span>          <span class="m">6</span>          <span class="m">7</span>
  <span class="n">delayed</span> <span class="m">0.20676692</span> <span class="m">0.14285714</span> <span class="m">0.14661654</span> <span class="m">0.11278195</span> <span class="m">0.15413534</span> <span class="m">0.06390977</span> <span class="m">0.17293233</span>
  <span class="n">ontime</span>  <span class="m">0.12618596</span> <span class="m">0.14516129</span> <span class="m">0.14421252</span> <span class="m">0.17077799</span> <span class="m">0.18121442</span> <span class="m">0.13092979</span> <span class="m">0.10151803</span>

<span class="o">&gt;</span> <span class="nf">dim</span><span class="p">(</span><span class="n">train.df</span><span class="p">)</span>
<span class="n">[1]</span> <span class="m">1320</span>    <span class="m">6</span>
<span class="o">&gt;</span> <span class="nf">dim</span><span class="p">(</span><span class="n">valid.df</span><span class="p">)</span>
<span class="n">[1]</span> <span class="m">881</span>   <span class="m">6</span>
<span class="o">&gt;</span> <span class="nf">dim</span><span class="p">(</span><span class="n">delays.df</span><span class="p">)</span>
<span class="n">[1]</span> <span class="m">2201</span>   <span class="m">14</span>
<span class="o">&gt;</span> <span class="nf">P</span><span class="p">(</span><span class="n">delayed</span><span class="o">|</span><span class="n">Carrier</span><span class="o">=</span><span class="n">DL</span><span class="p">,</span> <span class="n">Day_Week</span><span class="o">=</span><span class="m">7</span><span class="p">,</span> <span class="n">Dep_Time</span><span class="o">=</span><span class="m">10</span><span class="p">,</span> <span class="n">Dest</span><span class="o">=</span><span class="n">LGA</span><span class="p">,</span> <span class="n">Origin</span><span class="o">=</span><span class="n">DCA</span>
<span class="n">Error</span><span class="o">:</span> <span class="n">unexpected</span> <span class="s">&#39;=&#39;</span> <span class="n">in</span> <span class="s">&quot;P(delayed|Carrier=&quot;</span>
<span class="o">&gt;</span> <span class="n">train.df.DL</span> <span class="o">&lt;-</span> <span class="nf">subset</span><span class="p">(</span><span class="n">train.df</span><span class="p">,</span> <span class="n">train.df</span><span class="o">$</span><span class="n">carrier</span> <span class="o">==</span> <span class="s">&#39;DL&#39;</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="nf">length</span><span class="p">(</span><span class="n">train.df.DL</span><span class="p">)</span>
<span class="n">[1]</span> <span class="m">6</span>
<span class="o">&gt;</span> <span class="nf">dim</span><span class="p">(</span><span class="n">train.df.DL</span><span class="p">)</span>
<span class="n">[1]</span> <span class="m">222</span>   <span class="m">6</span>
<span class="o">&gt;</span> <span class="nf">dim</span><span class="p">(</span><span class="nf">subset</span><span class="p">(</span><span class="n">train.df</span><span class="p">,</span> <span class="n">train.df</span><span class="o">$</span><span class="n">dayweek</span> <span class="o">==</span> <span class="s">&#39;7&#39;</span><span class="p">))</span><span class="n">[1]</span><span class="o">/</span><span class="m">1320</span>
<span class="n">[1]</span> <span class="m">0.1159091</span>
<span class="o">&gt;</span> <span class="nf">dim</span><span class="p">(</span><span class="nf">subset</span><span class="p">(</span><span class="n">train.df</span><span class="p">,</span> <span class="n">train.df</span><span class="o">$</span><span class="n">carrier</span> <span class="o">==</span> <span class="s">&#39;DL&#39;</span><span class="p">))</span><span class="n">[1]</span><span class="o">/</span><span class="m">1320</span>
<span class="n">[1]</span> <span class="m">0.1681818</span>
<span class="o">&gt;</span> <span class="nf">dim</span><span class="p">(</span><span class="nf">subset</span><span class="p">(</span><span class="n">train.df</span><span class="p">,</span> <span class="n">train.df</span><span class="o">$</span><span class="n">deptime</span> <span class="o">==</span> <span class="s">&#39;10&#39;</span><span class="p">))</span><span class="n">[1]</span><span class="o">/</span><span class="m">1320</span>
<span class="n">[1]</span> <span class="m">0.04848485</span>
<span class="o">&gt;</span> <span class="nf">dim</span><span class="p">(</span><span class="nf">subset</span><span class="p">(</span><span class="n">train.df</span><span class="p">,</span> <span class="n">train.df</span><span class="o">$</span><span class="n">dest</span> <span class="o">==</span> <span class="s">&#39;LGA&#39;</span><span class="p">))</span><span class="n">[1]</span><span class="o">/</span><span class="m">1320</span>
<span class="n">[1]</span> <span class="m">0.5128788</span>
<span class="o">&gt;</span> <span class="nf">dim</span><span class="p">(</span><span class="nf">subset</span><span class="p">(</span><span class="n">train.df</span><span class="p">,</span> <span class="n">train.df</span><span class="o">$</span><span class="n">ORI</span> <span class="o">==</span> <span class="s">&#39;LGA&#39;</span><span class="p">))</span><span class="n">[1]</span><span class="o">/</span><span class="m">1320</span>
<span class="n">[1]</span> <span class="m">0</span>
<span class="o">&gt;</span> <span class="nf">dim</span><span class="p">(</span><span class="nf">subset</span><span class="p">(</span><span class="n">train.df</span><span class="p">,</span> <span class="n">train.df</span><span class="o">$</span><span class="n">origin</span> <span class="o">==</span> <span class="s">&#39;DCA&#39;</span><span class="p">))</span><span class="n">[1]</span><span class="o">/</span><span class="m">1320</span>
<span class="n">[1]</span> <span class="m">0.6136364</span>
<span class="o">&gt;</span> <span class="m">0.1159091</span> <span class="o">*</span> <span class="m">0.1681818</span> <span class="o">*</span> <span class="m">0.04848485</span> <span class="o">*</span> <span class="m">0.5128788</span> <span class="o">*</span> <span class="m">0.6136364</span>
<span class="n">[1]</span> <span class="m">0.0002974599</span>
<span class="o">&gt;</span>


<span class="o">&gt;</span> <span class="n">df</span> <span class="o">&lt;-</span> <span class="nf">read.csv</span><span class="p">(</span><span class="s">&quot;D:\\Books\\HKU-BusinessAnalytics\\dataset\\FlightDelays.csv&quot;</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="n">df</span><span class="o">$</span><span class="n">deptime</span> <span class="o">&lt;-</span> <span class="nf">round</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">deptime</span><span class="o">/</span><span class="m">100</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="nf">head</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
  <span class="n">schedtime</span> <span class="n">carrier</span> <span class="n">deptime</span> <span class="n">dest</span> <span class="n">distance</span>     <span class="n">date</span> <span class="n">flightnumber</span> <span class="n">origin</span> <span class="n">weather</span> <span class="n">dayweek</span> <span class="n">daymonth</span> <span class="n">tailnu</span>  <span class="n">delay</span>
<span class="m">1</span>      <span class="m">1455</span>      <span class="n">OH</span>      <span class="m">15</span>  <span class="n">JFK</span>      <span class="m">184</span> <span class="m">1</span><span class="o">/</span><span class="m">1</span><span class="o">/</span><span class="m">2004</span>         <span class="m">5935</span>    <span class="n">BWI</span>       <span class="m">0</span>       <span class="m">4</span>        <span class="m">1</span> <span class="n">N940CA</span> <span class="n">ontime</span>
<span class="m">2</span>      <span class="m">1640</span>      <span class="n">DH</span>      <span class="m">16</span>  <span class="n">JFK</span>      <span class="m">213</span> <span class="m">1</span><span class="o">/</span><span class="m">1</span><span class="o">/</span><span class="m">2004</span>         <span class="m">6155</span>    <span class="n">DCA</span>       <span class="m">0</span>       <span class="m">4</span>        <span class="m">1</span> <span class="n">N405FJ</span> <span class="n">ontime</span>
<span class="m">3</span>      <span class="m">1245</span>      <span class="n">DH</span>      <span class="m">12</span>  <span class="n">LGA</span>      <span class="m">229</span> <span class="m">1</span><span class="o">/</span><span class="m">1</span><span class="o">/</span><span class="m">2004</span>         <span class="m">7208</span>    <span class="n">IAD</span>       <span class="m">0</span>       <span class="m">4</span>        <span class="m">1</span> <span class="n">N695BR</span> <span class="n">ontime</span>
<span class="m">4</span>      <span class="m">1715</span>      <span class="n">DH</span>      <span class="m">17</span>  <span class="n">LGA</span>      <span class="m">229</span> <span class="m">1</span><span class="o">/</span><span class="m">1</span><span class="o">/</span><span class="m">2004</span>         <span class="m">7215</span>    <span class="n">IAD</span>       <span class="m">0</span>       <span class="m">4</span>        <span class="m">1</span> <span class="n">N662BR</span> <span class="n">ontime</span>
<span class="m">5</span>      <span class="m">1039</span>      <span class="n">DH</span>      <span class="m">10</span>  <span class="n">LGA</span>      <span class="m">229</span> <span class="m">1</span><span class="o">/</span><span class="m">1</span><span class="o">/</span><span class="m">2004</span>         <span class="m">7792</span>    <span class="n">IAD</span>       <span class="m">0</span>       <span class="m">4</span>        <span class="m">1</span> <span class="n">N698BR</span> <span class="n">ontime</span>
<span class="m">6</span>       <span class="m">840</span>      <span class="n">DH</span>       <span class="m">8</span>  <span class="n">JFK</span>      <span class="m">228</span> <span class="m">1</span><span class="o">/</span><span class="m">1</span><span class="o">/</span><span class="m">2004</span>         <span class="m">7800</span>    <span class="n">IAD</span>       <span class="m">0</span>       <span class="m">4</span>        <span class="m">1</span> <span class="n">N687BR</span> <span class="n">ontime</span>
<span class="o">&gt;</span> <span class="n">df</span><span class="o">$</span><span class="n">deptime</span> <span class="o">&lt;-</span> <span class="nf">factor</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">deptime</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="n">df</span><span class="o">$</span><span class="n">dayweek</span> <span class="o">&lt;-</span> <span class="nf">factor</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">dayweek</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="nf">head</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
  <span class="n">schedtime</span> <span class="n">carrier</span> <span class="n">deptime</span> <span class="n">dest</span> <span class="n">distance</span>     <span class="n">date</span> <span class="n">flightnumber</span> <span class="n">origin</span> <span class="n">weather</span> <span class="n">dayweek</span> <span class="n">daymonth</span> <span class="n">tailnu</span>  <span class="n">delay</span>
<span class="m">1</span>      <span class="m">1455</span>      <span class="n">OH</span>      <span class="m">15</span>  <span class="n">JFK</span>      <span class="m">184</span> <span class="m">1</span><span class="o">/</span><span class="m">1</span><span class="o">/</span><span class="m">2004</span>         <span class="m">5935</span>    <span class="n">BWI</span>       <span class="m">0</span>       <span class="m">4</span>        <span class="m">1</span> <span class="n">N940CA</span> <span class="n">ontime</span>
<span class="m">2</span>      <span class="m">1640</span>      <span class="n">DH</span>      <span class="m">16</span>  <span class="n">JFK</span>      <span class="m">213</span> <span class="m">1</span><span class="o">/</span><span class="m">1</span><span class="o">/</span><span class="m">2004</span>         <span class="m">6155</span>    <span class="n">DCA</span>       <span class="m">0</span>       <span class="m">4</span>        <span class="m">1</span> <span class="n">N405FJ</span> <span class="n">ontime</span>
<span class="m">3</span>      <span class="m">1245</span>      <span class="n">DH</span>      <span class="m">12</span>  <span class="n">LGA</span>      <span class="m">229</span> <span class="m">1</span><span class="o">/</span><span class="m">1</span><span class="o">/</span><span class="m">2004</span>         <span class="m">7208</span>    <span class="n">IAD</span>       <span class="m">0</span>       <span class="m">4</span>        <span class="m">1</span> <span class="n">N695BR</span> <span class="n">ontime</span>
<span class="m">4</span>      <span class="m">1715</span>      <span class="n">DH</span>      <span class="m">17</span>  <span class="n">LGA</span>      <span class="m">229</span> <span class="m">1</span><span class="o">/</span><span class="m">1</span><span class="o">/</span><span class="m">2004</span>         <span class="m">7215</span>    <span class="n">IAD</span>       <span class="m">0</span>       <span class="m">4</span>        <span class="m">1</span> <span class="n">N662BR</span> <span class="n">ontime</span>
<span class="m">5</span>      <span class="m">1039</span>      <span class="n">DH</span>      <span class="m">10</span>  <span class="n">LGA</span>      <span class="m">229</span> <span class="m">1</span><span class="o">/</span><span class="m">1</span><span class="o">/</span><span class="m">2004</span>         <span class="m">7792</span>    <span class="n">IAD</span>       <span class="m">0</span>       <span class="m">4</span>        <span class="m">1</span> <span class="n">N698BR</span> <span class="n">ontime</span>
<span class="m">6</span>       <span class="m">840</span>      <span class="n">DH</span>       <span class="m">8</span>  <span class="n">JFK</span>      <span class="m">228</span> <span class="m">1</span><span class="o">/</span><span class="m">1</span><span class="o">/</span><span class="m">2004</span>         <span class="m">7800</span>    <span class="n">IAD</span>       <span class="m">0</span>       <span class="m">4</span>        <span class="m">1</span> <span class="n">N687BR</span> <span class="n">ontime</span>
<span class="o">&gt;</span> <span class="nf">t</span><span class="p">(</span><span class="nf">t</span><span class="p">(</span><span class="nf">colnames</span><span class="p">(</span><span class="n">df</span><span class="p">)))</span>
      <span class="n">[</span><span class="p">,</span><span class="m">1</span><span class="n">]</span>
 <span class="n">[1</span><span class="p">,</span><span class="n">]</span> <span class="s">&quot;schedtime&quot;</span>
 <span class="n">[2</span><span class="p">,</span><span class="n">]</span> <span class="s">&quot;carrier&quot;</span>
 <span class="n">[3</span><span class="p">,</span><span class="n">]</span> <span class="s">&quot;deptime&quot;</span>
 <span class="n">[4</span><span class="p">,</span><span class="n">]</span> <span class="s">&quot;dest&quot;</span>
 <span class="n">[5</span><span class="p">,</span><span class="n">]</span> <span class="s">&quot;distance&quot;</span>
 <span class="n">[6</span><span class="p">,</span><span class="n">]</span> <span class="s">&quot;date&quot;</span>
 <span class="n">[7</span><span class="p">,</span><span class="n">]</span> <span class="s">&quot;flightnumber&quot;</span>
 <span class="n">[8</span><span class="p">,</span><span class="n">]</span> <span class="s">&quot;origin&quot;</span>
 <span class="n">[9</span><span class="p">,</span><span class="n">]</span> <span class="s">&quot;weather&quot;</span>
<span class="n">[10</span><span class="p">,</span><span class="n">]</span> <span class="s">&quot;dayweek&quot;</span>
<span class="n">[11</span><span class="p">,</span><span class="n">]</span> <span class="s">&quot;daymonth&quot;</span>
<span class="n">[12</span><span class="p">,</span><span class="n">]</span> <span class="s">&quot;tailnu&quot;</span>
<span class="n">[13</span><span class="p">,</span><span class="n">]</span> <span class="s">&quot;delay&quot;</span>
<span class="o">&gt;</span> <span class="n">selected.var</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="m">10</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">8</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">2</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="n">delay.train.index</span> <span class="o">&lt;-</span> <span class="nf">sample</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="nf">dim</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="n">[1]</span><span class="p">,</span> <span class="nf">dim</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="n">[1]</span> <span class="o">*</span> <span class="m">0.6</span> <span class="p">))</span>
<span class="o">&gt;</span> <span class="nf">dim</span><span class="p">(</span><span class="n">delay.train.index</span><span class="p">)</span>
<span class="kc">NULL</span>
<span class="o">&gt;</span> <span class="nf">length</span><span class="p">(</span><span class="n">delay.train.index</span><span class="p">)</span>
<span class="n">[1]</span> <span class="m">2202</span>
<span class="o">&gt;</span> <span class="nf">dim</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="n">[1]</span> <span class="m">2201</span>   <span class="m">13</span>
<span class="o">&gt;</span> <span class="n">delay.train.index</span> <span class="o">&lt;-</span> <span class="nf">sample</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="nf">dim</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="n">[1]</span><span class="p">),</span> <span class="nf">dim</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="n">[1]</span> <span class="o">*</span> <span class="m">0.6</span> <span class="p">)</span>
<span class="o">&gt;</span> <span class="nf">length</span><span class="p">(</span><span class="n">delay.train.index</span><span class="p">)</span>
<span class="n">[1]</span> <span class="m">1320</span>
<span class="o">&gt;</span> <span class="m">2202</span> <span class="o">*</span> <span class="m">0.6</span>
<span class="n">[1]</span> <span class="m">1321.2</span>
<span class="o">&gt;</span> <span class="n">delay.train.data</span> <span class="o">&lt;-</span> <span class="n">df[delay.train.index</span><span class="p">,</span> <span class="n">selected.var]</span>
<span class="o">&gt;</span> <span class="n">delay.valid.data</span> <span class="o">&lt;-</span> <span class="n">df[</span><span class="o">-</span><span class="n">delay.train.index</span><span class="p">,</span> <span class="n">selected.var]</span>
<span class="o">&gt;</span> <span class="n">delay.naivebayes</span> <span class="o">&lt;-</span> <span class="nf">naiveBayes</span><span class="p">(</span><span class="n">delay</span> <span class="o">~</span> <span class="n">.,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">delay.train.data</span><span class="p">)</span>
<span class="n">Error</span> <span class="n">in</span> <span class="nf">eval</span><span class="p">(</span><span class="n">predvars</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span> <span class="o">:</span> <span class="n">object</span> <span class="s">&#39;delay&#39;</span> <span class="n">not</span> <span class="n">found</span>
<span class="o">&gt;</span> <span class="n">selected.var</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="m">10</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">8</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">13</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="n">delay.train.data</span> <span class="o">&lt;-</span> <span class="n">df[delay.train.index</span><span class="p">,</span> <span class="n">selected.var]</span>
<span class="o">&gt;</span> <span class="n">delay.valid.data</span> <span class="o">&lt;-</span> <span class="n">df[</span><span class="o">-</span><span class="n">delay.train.index</span><span class="p">,</span> <span class="n">selected.var]</span>
<span class="o">&gt;</span> <span class="n">delay.naivebayes</span> <span class="o">&lt;-</span> <span class="nf">naiveBayes</span><span class="p">(</span><span class="n">delay</span> <span class="o">~</span> <span class="n">.,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">delay.train.data</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="n">delay.naivebayes</span>

<span class="n">Naive</span> <span class="n">Bayes</span> <span class="n">Classifier</span> <span class="n">for</span> <span class="n">Discrete</span> <span class="n">Predictors</span>

<span class="n">Call</span><span class="o">:</span>
<span class="nf">naiveBayes.default</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">Y</span><span class="p">,</span> <span class="n">laplace</span> <span class="o">=</span> <span class="n">laplace</span><span class="p">)</span>

<span class="n">A</span><span class="o">-</span><span class="n">priori</span> <span class="n">probabilities</span><span class="o">:</span>
<span class="n">Y</span>
  <span class="n">delayed</span>    <span class="n">ontime</span>
<span class="m">0.1931818</span> <span class="m">0.8068182</span>

<span class="n">Conditional</span> <span class="n">probabilities</span><span class="o">:</span>
         <span class="n">dayweek</span>
<span class="n">Y</span>                  <span class="m">1</span>          <span class="m">2</span>          <span class="m">3</span>          <span class="m">4</span>          <span class="m">5</span>          <span class="m">6</span>          <span class="m">7</span>
  <span class="n">delayed</span> <span class="m">0.17254902</span> <span class="m">0.16078431</span> <span class="m">0.12549020</span> <span class="m">0.11764706</span> <span class="m">0.18431373</span> <span class="m">0.07450980</span> <span class="m">0.16470588</span>
  <span class="n">ontime</span>  <span class="m">0.12300469</span> <span class="m">0.14835681</span> <span class="m">0.14272300</span> <span class="m">0.17558685</span> <span class="m">0.18403756</span> <span class="m">0.13051643</span> <span class="m">0.09577465</span>

         <span class="n">deptime</span>
<span class="n">Y</span>                    <span class="m">0</span>            <span class="m">1</span>            <span class="m">5</span>            <span class="m">6</span>            <span class="m">7</span>            <span class="m">8</span>            <span class="m">9</span>           <span class="m">10</span>           <span class="m">11</span>           <span class="m">12</span>
  <span class="n">delayed</span> <span class="m">0.0039215686</span> <span class="m">0.0039215686</span> <span class="m">0.0000000000</span> <span class="m">0.0235294118</span> <span class="m">0.0588235294</span> <span class="m">0.0470588235</span> <span class="m">0.0235294118</span> <span class="m">0.0196078431</span> <span class="m">0.0235294118</span> <span class="m">0.0156862745</span>
  <span class="n">ontime</span>  <span class="m">0.0000000000</span> <span class="m">0.0000000000</span> <span class="m">0.0009389671</span> <span class="m">0.0647887324</span> <span class="m">0.0535211268</span> <span class="m">0.0760563380</span> <span class="m">0.0629107981</span> <span class="m">0.0488262911</span> <span class="m">0.0450704225</span> <span class="m">0.0685446009</span>
         <span class="n">deptime</span>
<span class="n">Y</span>                   <span class="m">13</span>           <span class="m">14</span>           <span class="m">15</span>           <span class="m">16</span>           <span class="m">17</span>           <span class="m">18</span>           <span class="m">19</span>           <span class="m">20</span>           <span class="m">21</span>           <span class="m">22</span>
  <span class="n">delayed</span> <span class="m">0.0666666667</span> <span class="m">0.0431372549</span> <span class="m">0.1215686275</span> <span class="m">0.1294117647</span> <span class="m">0.0784313725</span> <span class="m">0.0745098039</span> <span class="m">0.1058823529</span> <span class="m">0.0745098039</span> <span class="m">0.0235294118</span> <span class="m">0.0549019608</span>
  <span class="n">ontime</span>  <span class="m">0.0610328638</span> <span class="m">0.0704225352</span> <span class="m">0.0948356808</span> <span class="m">0.0835680751</span> <span class="m">0.1032863850</span> <span class="m">0.0394366197</span> <span class="m">0.0431924883</span> <span class="m">0.0291079812</span> <span class="m">0.0544600939</span> <span class="m">0.0000000000</span>
         <span class="n">deptime</span>
<span class="n">Y</span>                   <span class="m">23</span>
  <span class="n">delayed</span> <span class="m">0.0078431373</span>
  <span class="n">ontime</span>  <span class="m">0.0000000000</span>

         <span class="n">origin</span>
<span class="n">Y</span>                <span class="n">BWI</span>        <span class="n">DCA</span>        <span class="n">IAD</span>
  <span class="n">delayed</span> <span class="m">0.08235294</span> <span class="m">0.51764706</span> <span class="m">0.40000000</span>
  <span class="n">ontime</span>  <span class="m">0.05727700</span> <span class="m">0.65164319</span> <span class="m">0.29107981</span>

         <span class="n">dest</span>
<span class="n">Y</span>               <span class="n">EWR</span>       <span class="n">JFK</span>       <span class="n">LGA</span>
  <span class="n">delayed</span> <span class="m">0.3450980</span> <span class="m">0.2039216</span> <span class="m">0.4509804</span>
  <span class="n">ontime</span>  <span class="m">0.2920188</span> <span class="m">0.1774648</span> <span class="m">0.5305164</span>

         <span class="n">carrier</span>
<span class="n">Y</span>                  <span class="n">CO</span>          <span class="n">DH</span>          <span class="n">DL</span>          <span class="n">MQ</span>          <span class="n">OH</span>          <span class="n">RU</span>          <span class="n">UA</span>          <span class="n">US</span>
  <span class="n">delayed</span> <span class="m">0.054901961</span> <span class="m">0.333333333</span> <span class="m">0.098039216</span> <span class="m">0.207843137</span> <span class="m">0.011764706</span> <span class="m">0.207843137</span> <span class="m">0.003921569</span> <span class="m">0.082352941</span>
  <span class="n">ontime</span>  <span class="m">0.036619718</span> <span class="m">0.243192488</span> <span class="m">0.200000000</span> <span class="m">0.119248826</span> <span class="m">0.014084507</span> <span class="m">0.176525822</span> <span class="m">0.013145540</span> <span class="m">0.197183099</span>

<span class="o">&gt;</span> <span class="nf">prop.table</span><span class="p">(</span><span class="nf">table</span><span class="p">(</span><span class="n">delay.train.data</span><span class="o">$</span><span class="n">delay</span><span class="p">,</span> <span class="n">delay.train.data</span><span class="o">$</span><span class="n">dest</span><span class="p">,</span> <span class="n">delay.train.data</span><span class="o">$</span><span class="n">origin</span><span class="p">),</span> <span class="n">margin</span> <span class="o">=</span> <span class="m">2</span><span class="p">)</span>
<span class="p">,</span> <span class="p">,</span>  <span class="o">=</span> <span class="n">BWI</span>


                 <span class="n">EWR</span>        <span class="n">JFK</span>        <span class="n">LGA</span>
  <span class="n">delayed</span> <span class="m">0.04511278</span> <span class="m">0.01244813</span> <span class="m">0.00000000</span>
  <span class="n">ontime</span>  <span class="m">0.11528822</span> <span class="m">0.06224066</span> <span class="m">0.00000000</span>

<span class="p">,</span> <span class="p">,</span>  <span class="o">=</span> <span class="n">DCA</span>


                 <span class="n">EWR</span>        <span class="n">JFK</span>        <span class="n">LGA</span>
  <span class="n">delayed</span> <span class="m">0.07769424</span> <span class="m">0.09958506</span> <span class="m">0.11323529</span>
  <span class="n">ontime</span>  <span class="m">0.32832080</span> <span class="m">0.28215768</span> <span class="m">0.72794118</span>

<span class="p">,</span> <span class="p">,</span>  <span class="o">=</span> <span class="n">IAD</span>


                 <span class="n">EWR</span>        <span class="n">JFK</span>        <span class="n">LGA</span>
  <span class="n">delayed</span> <span class="m">0.09774436</span> <span class="m">0.10373444</span> <span class="m">0.05588235</span>
  <span class="n">ontime</span>  <span class="m">0.33583960</span> <span class="m">0.43983402</span> <span class="m">0.10294118</span>

<span class="o">&gt;</span> <span class="nf">prop.table</span><span class="p">(</span><span class="nf">table</span><span class="p">(</span><span class="n">delay.train.data</span><span class="o">$</span><span class="n">delay</span><span class="p">,</span> <span class="n">delay.train.data</span><span class="o">$</span><span class="n">dest</span><span class="p">),</span> <span class="n">margin</span> <span class="o">=</span> <span class="m">1</span><span class="p">)</span>

                <span class="n">EWR</span>       <span class="n">JFK</span>       <span class="n">LGA</span>
  <span class="n">delayed</span> <span class="m">0.3450980</span> <span class="m">0.2039216</span> <span class="m">0.4509804</span>
  <span class="n">ontime</span>  <span class="m">0.2920188</span> <span class="m">0.1774648</span> <span class="m">0.5305164</span>
<span class="o">&gt;</span> <span class="n">P.delayed.case</span> <span class="o">&lt;-</span> <span class="p">(</span><span class="m">0.98039216</span> <span class="o">*</span> <span class="m">0.16470588</span> <span class="o">*</span> <span class="m">0.0196078431</span> <span class="o">*</span> <span class="m">0.4509804</span> <span class="o">*</span> <span class="m">0.51764706</span><span class="p">)</span> <span class="o">*</span> <span class="m">0.1931818</span>
<span class="o">&gt;</span> <span class="n">P.delayed.case</span>
<span class="n">[1]</span> <span class="m">0.0001427895</span>
<span class="o">&gt;</span> <span class="n">P.ontime.case</span> <span class="o">&lt;-</span> <span class="p">(</span><span class="m">0.200000000</span> <span class="o">*</span> <span class="m">0.09577465</span> <span class="o">*</span> <span class="m">0.0488262911</span> <span class="o">*</span> <span class="m">0.5305164</span> <span class="o">*</span> <span class="m">0.65164319</span><span class="p">)</span> <span class="o">*</span> <span class="m">0.8068182</span>
<span class="o">&gt;</span> <span class="n">P.ontime.case</span>
<span class="n">[1]</span> <span class="m">0.0002608667</span>
<span class="o">&gt;</span> <span class="n">P.delayed</span> <span class="o">&lt;-</span> <span class="p">(</span><span class="n">P.delayed.case</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">P.delayed.case</span> <span class="o">+</span> <span class="n">P.ontime.case</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="n">P.delayed</span>
<span class="n">[1]</span> <span class="m">0.3537404</span>
<span class="o">&gt;</span> <span class="n">P.ontime</span> <span class="o">&lt;-</span> <span class="n">P.ontime.case</span> <span class="o">/</span> <span class="p">(</span><span class="n">P.delayed.case</span> <span class="o">+</span> <span class="n">P.ontime.case</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="n">P.ontime</span>
<span class="n">[1]</span> <span class="m">0.6462596</span>
<span class="o">&gt;</span> <span class="nf">ls</span><span class="p">()</span>
 <span class="n">[1]</span> <span class="s">&quot;a&quot;</span>                 <span class="s">&quot;age&quot;</span>               <span class="s">&quot;b&quot;</span>                 <span class="s">&quot;c&quot;</span>                 <span class="s">&quot;count&quot;</span>             <span class="s">&quot;d&quot;</span>                 <span class="s">&quot;data&quot;</span>
 <span class="n">[8]</span> <span class="s">&quot;data_index&quot;</span>        <span class="s">&quot;data_indexed&quot;</span>      <span class="s">&quot;delay.naivebayes&quot;</span>  <span class="s">&quot;delay.train.data&quot;</span>  <span class="s">&quot;delay.train.index&quot;</span> <span class="s">&quot;delay.valid.data&quot;</span>  <span class="s">&quot;delays.df&quot;</span>
<span class="n">[15]</span> <span class="s">&quot;delays.nb&quot;</span>         <span class="s">&quot;df&quot;</span>                <span class="s">&quot;df.nb&quot;</span>             <span class="s">&quot;df.nb2&quot;</span>            <span class="s">&quot;df_nb&quot;</span>             <span class="s">&quot;df_text&quot;</span>           <span class="s">&quot;df1&quot;</span>
<span class="n">[22]</span> <span class="s">&quot;df2&quot;</span>               <span class="s">&quot;dflarge&quot;</span>           <span class="s">&quot;dfNlarge&quot;</span>          <span class="s">&quot;dfNsmall&quot;</span>          <span class="s">&quot;dfsmall&quot;</span>           <span class="s">&quot;fp&quot;</span>                <span class="s">&quot;housing.df&quot;</span>
<span class="n">[29]</span> <span class="s">&quot;i&quot;</span>                 <span class="s">&quot;o&quot;</span>                 <span class="s">&quot;P.delayed&quot;</span>         <span class="s">&quot;P.delayed.case&quot;</span>    <span class="s">&quot;P.ontime&quot;</span>          <span class="s">&quot;P.ontime.case&quot;</span>     <span class="s">&quot;rows.missing10&quot;</span>
<span class="n">[36]</span> <span class="s">&quot;s&quot;</span>                 <span class="s">&quot;selected.var&quot;</span>      <span class="s">&quot;test2.data&quot;</span>        <span class="s">&quot;test2.rows&quot;</span>        <span class="s">&quot;train.data&quot;</span>        <span class="s">&quot;train.df&quot;</span>          <span class="s">&quot;train.df.DL&quot;</span>
<span class="n">[43]</span> <span class="s">&quot;train.index&quot;</span>       <span class="s">&quot;train.rows&quot;</span>        <span class="s">&quot;train2.data&quot;</span>       <span class="s">&quot;train2.rows&quot;</span>       <span class="s">&quot;v&quot;</span>                 <span class="s">&quot;VADeaths&quot;</span>          <span class="s">&quot;vald.data&quot;</span>
<span class="n">[50]</span> <span class="s">&quot;valid.data&quot;</span>        <span class="s">&quot;valid.df&quot;</span>          <span class="s">&quot;valid.rows&quot;</span>        <span class="s">&quot;valid2.data&quot;</span>       <span class="s">&quot;valid2.rows&quot;</span>       <span class="s">&quot;weight&quot;</span>            <span class="s">&quot;x&quot;</span>
<span class="n">[57]</span> <span class="s">&quot;xtotal&quot;</span>            <span class="s">&quot;xtotal.df&quot;</span>         <span class="s">&quot;y&quot;</span>
<span class="o">&gt;</span> <span class="n">pred.prob</span> <span class="o">&lt;-</span> <span class="nf">predict</span><span class="p">(</span><span class="n">delay.naivebayes</span><span class="p">,</span> <span class="n">newdata</span> <span class="o">=</span> <span class="n">delay.valid.data</span><span class="p">,</span> <span class="n">type</span><span class="o">=</span><span class="s">&quot;raw&quot;</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="n">pred.class</span> <span class="o">&lt;-</span> <span class="nf">predict</span><span class="p">(</span><span class="n">delay.naivebayes</span><span class="p">,</span> <span class="n">newdata</span> <span class="o">=</span> <span class="n">delay.valid.data</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="n">df</span> <span class="o">&lt;-</span> <span class="nf">data.frame</span><span class="p">(</span><span class="n">actual</span> <span class="o">=</span> <span class="n">delay.valid.data</span><span class="o">$</span><span class="n">delay</span><span class="p">,</span> <span class="n">predicted</span> <span class="o">=</span> <span class="n">pred.class</span><span class="p">,</span> <span class="n">pred.prob</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="nf">head</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
  <span class="n">actual</span> <span class="n">predicted</span>    <span class="n">delayed</span>    <span class="n">ontime</span>
<span class="m">1</span> <span class="n">ontime</span>    <span class="n">ontime</span> <span class="m">0.16321988</span> <span class="m">0.8367801</span>
<span class="m">2</span> <span class="n">ontime</span>    <span class="n">ontime</span> <span class="m">0.09350922</span> <span class="m">0.9064908</span>
<span class="m">3</span> <span class="n">ontime</span>    <span class="n">ontime</span> <span class="m">0.07361168</span> <span class="m">0.9263883</span>
<span class="m">4</span> <span class="n">ontime</span>    <span class="n">ontime</span> <span class="m">0.09989439</span> <span class="m">0.9001056</span>
<span class="m">5</span> <span class="n">ontime</span>    <span class="n">ontime</span> <span class="m">0.03150436</span> <span class="m">0.9684956</span>
<span class="m">6</span> <span class="n">ontime</span>    <span class="n">ontime</span> <span class="m">0.03876232</span> <span class="m">0.9612377</span>
<span class="o">&gt;</span> <span class="nf">head</span><span class="p">(</span><span class="n">pred.class</span><span class="p">)</span>
<span class="n">[1]</span> <span class="n">ontime</span> <span class="n">ontime</span> <span class="n">ontime</span> <span class="n">ontime</span> <span class="n">ontime</span> <span class="n">ontime</span>
<span class="n">Levels</span><span class="o">:</span> <span class="n">delayed</span> <span class="n">ontime</span>
<span class="o">&gt;</span> <span class="n">df[delay.valid.data</span><span class="o">$</span><span class="n">carrier</span> <span class="o">==</span> <span class="s">&#39;DL&#39;</span> <span class="o">&amp;</span> <span class="n">delay.valid.data</span><span class="o">$</span><span class="n">dayweek</span> <span class="o">==</span> <span class="m">7</span> <span class="o">&amp;</span> <span class="n">delay.valid.data</span><span class="o">$</span><span class="n">deptime</span> <span class="o">==</span> <span class="m">10</span> <span class="o">&amp;</span> <span class="n">delay.valid.data</span><span class="o">$</span><span class="n">dest</span> <span class="o">==</span> <span class="s">&quot;LGA&quot;</span> <span class="o">&amp;</span> <span class="n">delay.valid.data</span><span class="o">$</span><span class="n">origin</span> <span class="o">==</span> <span class="s">&#39;DCA&#39;</span><span class="p">,</span><span class="n">]</span>
<span class="n">[1]</span> <span class="n">actual</span>    <span class="n">predicted</span> <span class="n">delayed</span>   <span class="n">ontime</span>
<span class="o">&lt;</span><span class="m">0</span> 行<span class="o">&gt;</span> <span class="p">(</span>或<span class="m">0</span><span class="o">-</span>长度的<span class="n">row.names</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="nf">HEAD</span><span class="p">(</span><span class="n">DF</span><span class="p">)</span>
<span class="n">Error</span> <span class="n">in</span> <span class="nf">HEAD</span><span class="p">(</span><span class="n">DF</span><span class="p">)</span> <span class="o">:</span> <span class="n">could</span> <span class="n">not</span> <span class="n">find</span> <span class="n">function</span> <span class="s">&quot;HEAD&quot;</span>
<span class="o">&gt;</span> <span class="nf">head</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
  <span class="n">actual</span> <span class="n">predicted</span>    <span class="n">delayed</span>    <span class="n">ontime</span>
<span class="m">1</span> <span class="n">ontime</span>    <span class="n">ontime</span> <span class="m">0.16321988</span> <span class="m">0.8367801</span>
<span class="m">2</span> <span class="n">ontime</span>    <span class="n">ontime</span> <span class="m">0.09350922</span> <span class="m">0.9064908</span>
<span class="m">3</span> <span class="n">ontime</span>    <span class="n">ontime</span> <span class="m">0.07361168</span> <span class="m">0.9263883</span>
<span class="m">4</span> <span class="n">ontime</span>    <span class="n">ontime</span> <span class="m">0.09989439</span> <span class="m">0.9001056</span>
<span class="m">5</span> <span class="n">ontime</span>    <span class="n">ontime</span> <span class="m">0.03150436</span> <span class="m">0.9684956</span>
<span class="m">6</span> <span class="n">ontime</span>    <span class="n">ontime</span> <span class="m">0.03876232</span> <span class="m">0.9612377</span>
<span class="o">&gt;</span> <span class="n">df</span> <span class="o">&lt;-</span> <span class="nf">data.frame</span><span class="p">(</span><span class="n">delay.valid.data</span><span class="p">,</span> <span class="n">actual</span> <span class="o">=</span> <span class="n">delay.valid.data</span><span class="o">$</span><span class="n">delay</span><span class="p">,</span> <span class="n">predicted</span> <span class="o">=</span> <span class="n">pred.class</span><span class="p">,</span> <span class="n">pred.prob</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="nf">head</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
   <span class="n">dayweek</span> <span class="n">deptime</span> <span class="n">origin</span> <span class="n">dest</span> <span class="n">carrier</span>  <span class="n">delay</span> <span class="n">actual</span> <span class="n">predicted</span>    <span class="n">delayed</span>    <span class="n">ontime</span>
<span class="m">4</span>        <span class="m">4</span>      <span class="m">17</span>    <span class="n">IAD</span>  <span class="n">LGA</span>      <span class="n">DH</span> <span class="n">ontime</span> <span class="n">ontime</span>    <span class="n">ontime</span> <span class="m">0.16321988</span> <span class="m">0.8367801</span>
<span class="m">5</span>        <span class="m">4</span>      <span class="m">10</span>    <span class="n">IAD</span>  <span class="n">LGA</span>      <span class="n">DH</span> <span class="n">ontime</span> <span class="n">ontime</span>    <span class="n">ontime</span> <span class="m">0.09350922</span> <span class="m">0.9064908</span>
<span class="m">7</span>        <span class="m">4</span>      <span class="m">12</span>    <span class="n">IAD</span>  <span class="n">JFK</span>      <span class="n">DH</span> <span class="n">ontime</span> <span class="n">ontime</span>    <span class="n">ontime</span> <span class="m">0.07361168</span> <span class="m">0.9263883</span>
<span class="m">11</span>       <span class="m">4</span>      <span class="m">21</span>    <span class="n">IAD</span>  <span class="n">LGA</span>      <span class="n">DH</span> <span class="n">ontime</span> <span class="n">ontime</span>    <span class="n">ontime</span> <span class="m">0.09989439</span> <span class="m">0.9001056</span>
<span class="m">15</span>       <span class="m">4</span>      <span class="m">14</span>    <span class="n">DCA</span>  <span class="n">LGA</span>      <span class="n">DL</span> <span class="n">ontime</span> <span class="n">ontime</span>    <span class="n">ontime</span> <span class="m">0.03150436</span> <span class="m">0.9684956</span>
<span class="m">16</span>       <span class="m">4</span>      <span class="m">17</span>    <span class="n">DCA</span>  <span class="n">LGA</span>      <span class="n">DL</span> <span class="n">ontime</span> <span class="n">ontime</span>    <span class="n">ontime</span> <span class="m">0.03876232</span> <span class="m">0.9612377</span>
<span class="o">&gt;</span> <span class="n">df[delay.valid.data</span><span class="o">$</span><span class="n">carrier</span> <span class="o">==</span> <span class="s">&#39;DL&#39;</span> <span class="o">&amp;</span> <span class="n">delay.valid.data</span><span class="o">$</span><span class="n">dayweek</span> <span class="o">==</span> <span class="m">7</span> <span class="o">&amp;</span> <span class="n">delay.valid.data</span><span class="o">$</span><span class="n">deptime</span> <span class="o">==</span> <span class="m">10</span> <span class="o">&amp;</span> <span class="n">delay.valid.data</span><span class="o">$</span><span class="n">dest</span> <span class="o">==</span> <span class="s">&quot;LGA&quot;</span> <span class="o">&amp;</span> <span class="n">delay.valid.data</span><span class="o">$</span><span class="n">origin</span> <span class="o">==</span> <span class="s">&#39;DCA&#39;</span><span class="p">,</span><span class="n">]</span>
 <span class="n">[1]</span> <span class="n">dayweek</span>   <span class="n">deptime</span>   <span class="n">origin</span>    <span class="n">dest</span>      <span class="n">carrier</span>   <span class="n">delay</span>     <span class="n">actual</span>    <span class="n">predicted</span> <span class="n">delayed</span>   <span class="n">ontime</span>
<span class="o">&gt;</span> <span class="n">df</span>
    <span class="n">dayweek</span> <span class="n">deptime</span> <span class="n">origin</span> <span class="n">dest</span> <span class="n">carrier</span>   <span class="n">delay</span>  <span class="n">actual</span> <span class="n">predicted</span>    <span class="n">delayed</span>     <span class="n">ontime</span>
<span class="m">4</span>         <span class="m">4</span>      <span class="m">17</span>    <span class="n">IAD</span>  <span class="n">LGA</span>      <span class="n">DH</span>  <span class="n">ontime</span>  <span class="n">ontime</span>    <span class="n">ontime</span> <span class="m">0.16321988</span> <span class="m">0.83678012</span>
<span class="m">5</span>         <span class="m">4</span>      <span class="m">10</span>    <span class="n">IAD</span>  <span class="n">LGA</span>      <span class="n">DH</span>  <span class="n">ontime</span>  <span class="n">ontime</span>    <span class="n">ontime</span> <span class="m">0.09350922</span> <span class="m">0.90649078</span>
<span class="m">7</span>         <span class="m">4</span>      <span class="m">12</span>    <span class="n">IAD</span>  <span class="n">JFK</span>      <span class="n">DH</span>  <span class="n">ontime</span>  <span class="n">ontime</span>    <span class="n">ontime</span> <span class="m">0.07361168</span> <span class="m">0.92638832</span>
<span class="m">11</span>        <span class="m">4</span>      <span class="m">21</span>    <span class="n">IAD</span>  <span class="n">LGA</span>      <span class="n">DH</span>  <span class="n">ontime</span>  <span class="n">ontime</span>    <span class="n">ontime</span> <span class="m">0.09989439</span> <span class="m">0.90010561</span>
<span class="m">15</span>        <span class="m">4</span>      <span class="m">14</span>    <span class="n">DCA</span>  <span class="n">LGA</span>      <span class="n">DL</span>  <span class="n">ontime</span>  <span class="n">ontime</span>    <span class="n">ontime</span> <span class="m">0.03150436</span> <span class="m">0.96849564</span>
<span class="m">16</span>        <span class="m">4</span>      <span class="m">17</span>    <span class="n">DCA</span>  <span class="n">LGA</span>      <span class="n">DL</span>  <span class="n">ontime</span>  <span class="n">ontime</span>    <span class="n">ontime</span> <span class="m">0.03876232</span> <span class="m">0.96123768</span>
<span class="m">20</span>        <span class="m">4</span>      <span class="m">18</span>    <span class="n">DCA</span>  <span class="n">JFK</span>      <span class="n">MQ</span>  <span class="n">ontime</span>  <span class="n">ontime</span>    <span class="n">ontime</span> <span class="m">0.32533864</span> <span class="m">0.67466136</span>



<span class="o">&gt;</span> <span class="nf">library</span><span class="p">(</span><span class="n">caret</span><span class="p">)</span>
载入需要的程辑包：<span class="n">lattice</span>
载入需要的程辑包：<span class="n">ggplot2</span>
<span class="n">Warning</span> <span class="n">messages</span><span class="o">:</span>
<span class="m">1</span><span class="o">:</span> 程辑包‘<span class="n">caret</span>’是用<span class="n">R版本3.6.2</span> 来建造的
<span class="m">2</span><span class="o">:</span> 程辑包‘<span class="n">ggplot2</span>’是用<span class="n">R版本3.6.2</span> 来建造的
<span class="o">&gt;</span> <span class="nf">confusionMatrix</span><span class="p">(</span><span class="n">pred.class</span><span class="p">,</span> <span class="n">delay.valid.data</span><span class="o">$</span><span class="n">delay</span><span class="p">)</span>
<span class="n">Confusion</span> <span class="n">Matrix</span> <span class="n">and</span> <span class="n">Statistics</span>

          <span class="n">Reference</span>
<span class="n">Prediction</span> <span class="n">delayed</span> <span class="n">ontime</span>
   <span class="n">delayed</span>      <span class="m">25</span>     <span class="m">12</span>
   <span class="n">ontime</span>      <span class="m">148</span>    <span class="m">696</span>

               <span class="n">Accuracy</span> <span class="o">:</span> <span class="m">0.8184</span>
                 <span class="m">95</span><span class="o">% CI : (0.7913, 0.8433)</span>
<span class="o">    No Information Rate : 0.8036</span>
<span class="o">    P-Value [Acc &gt; NIR] : 0.1443</span>

<span class="o">                  Kappa : 0.1815</span>

<span class="o"> Mcnemar&#39;s Test P-Value : &lt;2e-16</span>

<span class="o">            Sensitivity : 0.14451</span>
<span class="o">            Specificity : 0.98305</span>
<span class="o">         Pos Pred Value : 0.67568</span>
<span class="o">         Neg Pred Value : 0.82464</span>
<span class="o">             Prevalence : 0.19637</span>
<span class="o">         Detection Rate : 0.02838</span>
<span class="o">   Detection Prevalence : 0.04200</span>
<span class="o">      Balanced Accuracy : 0.56378</span>

<span class="o">       &#39;Positive&#39; Class : delayed</span>

<span class="o">&gt; pred.class.train &lt;- predict(delay.naivebayes, newdata = delay.train.data)</span>
<span class="o">&gt; confusionMatrix(pred.class.train, delay.train.data$delay)</span>
<span class="o">Confusion Matrix and Statistics</span>

<span class="o">          Reference</span>
<span class="o">Prediction delayed ontime</span>
<span class="o">   delayed      52     18</span>
<span class="o">   ontime      203   1047</span>

<span class="o">               Accuracy : 0.8326</span>
<span class="o">                 95%</span> <span class="n">CI</span> <span class="o">:</span> <span class="p">(</span><span class="m">0.8113</span><span class="p">,</span> <span class="m">0.8523</span><span class="p">)</span>
    <span class="n">No</span> <span class="n">Information</span> <span class="n">Rate</span> <span class="o">:</span> <span class="m">0.8068</span>
    <span class="n">P</span><span class="o">-</span><span class="n">Value</span> <span class="n">[Acc</span> <span class="o">&gt;</span> <span class="n">NIR]</span> <span class="o">:</span> <span class="m">0.008903</span>

                  <span class="n">Kappa</span> <span class="o">:</span> <span class="m">0.2583</span>

 <span class="n">Mcnemar</span><span class="s">&#39;s Test P-Value : &lt; 2.2e-16</span>

<span class="s">            Sensitivity : 0.20392</span>
<span class="s">            Specificity : 0.98310</span>
<span class="s">         Pos Pred Value : 0.74286</span>
<span class="s">         Neg Pred Value : 0.83760</span>
<span class="s">             Prevalence : 0.19318</span>
<span class="s">         Detection Rate : 0.03939</span>
<span class="s">   Detection Prevalence : 0.05303</span>
<span class="s">      Balanced Accuracy : 0.59351</span>

<span class="s">       &#39;</span><span class="n">Positive</span><span class="s">&#39; Class : delayed</span>

<span class="s">&gt; pred.class.valid &lt;- predict(delay.naivebayes, newdata = delay.valid.data)</span>
<span class="s">&gt; confusionMatrix(pred.class.valid, delay.valid.data$delay)</span>
<span class="s">Confusion Matrix and Statistics</span>

<span class="s">          Reference</span>
<span class="s">Prediction delayed ontime</span>
<span class="s">   delayed      25     12</span>
<span class="s">   ontime      148    696</span>

<span class="s">               Accuracy : 0.8184</span>
<span class="s">                 95% CI : (0.7913, 0.8433)</span>
<span class="s">    No Information Rate : 0.8036</span>
<span class="s">    P-Value [Acc &gt; NIR] : 0.1443</span>

<span class="s">                  Kappa : 0.1815</span>

<span class="s"> Mcnemar&#39;</span><span class="n">s</span> <span class="n">Test</span> <span class="n">P</span><span class="o">-</span><span class="n">Value</span> <span class="o">:</span> <span class="o">&lt;</span><span class="m">2e-16</span>

            <span class="n">Sensitivity</span> <span class="o">:</span> <span class="m">0.14451</span>
            <span class="n">Specificity</span> <span class="o">:</span> <span class="m">0.98305</span>
         <span class="n">Pos</span> <span class="n">Pred</span> <span class="n">Value</span> <span class="o">:</span> <span class="m">0.67568</span>
         <span class="n">Neg</span> <span class="n">Pred</span> <span class="n">Value</span> <span class="o">:</span> <span class="m">0.82464</span>
             <span class="n">Prevalence</span> <span class="o">:</span> <span class="m">0.19637</span>
         <span class="n">Detection</span> <span class="n">Rate</span> <span class="o">:</span> <span class="m">0.02838</span>
   <span class="n">Detection</span> <span class="n">Prevalence</span> <span class="o">:</span> <span class="m">0.04200</span>
      <span class="n">Balanced</span> <span class="n">Accuracy</span> <span class="o">:</span> <span class="m">0.56378</span>

       <span class="s">&#39;Positive&#39;</span> <span class="n">Class</span> <span class="o">:</span> <span class="n">delayed</span>
</pre></div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="ml-tfidf.html" class="btn btn-neutral float-right" title="样例 - TFIDF" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="ml-lm.html" class="btn btn-neutral float-left" title="样例 - 回归" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Shaofei Wang

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>